# Chat Panel

Панель чата для общения с AI ассистентом Giga Router.

## Структура

```
Chat/
├── components/          # React компоненты
│   ├── ChatHeader.tsx  # Заголовок чата
│   ├── ChatInput.tsx   # Поле ввода сообщения
│   ├── MessageItem.tsx # Отдельное сообщение
│   ├── MessageList.tsx # Список сообщений
│   └── index.ts        # Экспорты компонентов
├── hooks/              # Кастомные хуки
│   ├── useChatHandlers.ts    # Обработчики действий чата
│   ├── useChatNavigation.ts  # Навигация в чате
│   ├── useMessengerScroll.ts # Автоматический скролл
│   └── index.ts              # Экспорты хуков
├── models/             # Модели данных
│   ├── ChatViewModel.ts  # ViewModel управления чатом
│   ├── MessageModel.ts   # Модель сообщения
│   └── index.ts          # Экспорты моделей
├── Chat.tsx            # Главный компонент панели
├── constants.ts        # Константы (текста, размеры, URL)
├── styles.ts           # Стили компонентов
├── types.ts            # TypeScript типы и интерфейсы
└── index.ts            # Экспорт панели

```

## Основные возможности

- ✅ Потоковая генерация ответов (streaming)
- ✅ Отображение статистики токенов и стоимости
- ✅ Автоматический скролл при печатании
- ✅ Skeleton загрузки для сообщений
- ✅ Копирование сообщений
- ✅ Подсветка кода в markdown
- ✅ Выбор модели AI

## Компоненты

### Chat
Главный компонент панели. Координирует работу всех подкомпонентов.

### ChatHeader
Отображает информацию о боте:
- Аватар
- Название (Giga Router)
- Статус (печатает / текущая модель)

### MessageList
Список сообщений с двумя состояниями:
- Пустое состояние - плейсхолдер с кнопкой запуска
- Список сообщений

### MessageItem
Отдельное сообщение с:
- Аватаром отправителя
- Содержимым (с поддержкой markdown)
- Кнопкой копирования
- Статистикой токенов (для ассистента)

### ChatInput
Поле ввода с:
- Кнопкой отправки
- Выбором модели
- Блокировкой при загрузке

## Хуки

### useMessengerScroll
Управляет автоматическим скроллом:
- Скролл во время печатания
- Кнопка "прокрутить вниз"
- Блокировка скролла при касании пользователя

### useChatHandlers
Обработчики действий:
- Отправка сообщений
- Запуск приветственного диалога
- Копирование текста

### useChatNavigation
Навигация:
- Возврат назад
- Переход к выбору модели

## Модели

### ChatViewModel (MobX)
Управляет состоянием чата:
- `messages` - список сообщений
- `isTyping` - флаг печатания
- `isLoading` - флаг загрузки
- `currentModel` - текущая модель
- `error` - ошибка

**Методы:**
- `sendMessage()` - отправить сообщение
- `startWelcomeChat()` - начать диалог
- `clearMessages()` - очистить сообщения
- `setModel()` - изменить модель

### MessageModel (MobX)
Модель сообщения:
- `id` - уникальный идентификатор
- `role` - роль (user/assistant/system)
- `content` - текст сообщения
- `isTyping` - флаг печатания
- `timestamp` - время создания
- `usage` - статистика токенов

## Константы

Все магические значения вынесены в `constants.ts`:
- Размеры (высота хедера, отступы)
- Задержки (скролл)
- Тексты UI
- URL изображений
- Z-индексы

## Стили

Стили вынесены в `styles.ts` для переиспользования:
- `chatContainerStyle`
- `chatHeaderStyle`
- `messagesScrollContainerStyle`
- `scrollArrowContainerStyle`

## Использование

```tsx
import { Chat } from "./panels/Chat";

<Chat id="chat" />
```

## API

Чат использует API endpoint:
```
POST /v1/chat/completions
```

С поддержкой:
- Streaming ответов (SSE)
- Статистики токенов
- Нескольких моделей

## Особенности реализации

1. **Streaming** - ответы приходят потоком через SSE
2. **MobX** - реактивное управление состоянием
3. **Оптимизация** - мемоизация колбэков через useCallback
4. **Типизация** - полная типизация TypeScript
5. **Комментарии** - JSDoc для всех публичных методов



