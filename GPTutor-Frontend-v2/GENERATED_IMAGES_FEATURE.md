# üé® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## ‚ú® –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `google/gemini-2.5-flash-image`).

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 1. MessageModel

**–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ:**
```typescript
generatedImages: ImageAttachment[] = []; // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç –º–æ–¥–µ–ª–∏
```

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `addGeneratedImages(images)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç –º–æ–¥–µ–ª–∏
- `setGeneratedImages(images)` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `hasGeneratedImages` - getter –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 2. ChatViewModel

**–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `streamCompletion`:**
- –ü–∞—Ä—Å–∏—Ç `delta.images` –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
- –î–æ–±–∞–≤–ª—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. MessageItem

**–î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- Responsive –¥–∏–∑–∞–π–Ω (max-width: 512px)
- Lazy loading –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (border-radius: 8px)

---

## üìä –§–æ—Ä–º–∞—Ç API

### –ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```typescript
{
  "model": "google/gemini-2.5-flash-image",
  "messages": [
    {
      "role": "user",
      "content": "–ù–∞—Ä–∏—Å—É–π –∫–æ—Ç–∞"
    }
  ],
  "stream": true
}
```

### –û—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ (SSE):

```json
{
  "id": "gen-1760008258-...",
  "provider": "Google AI Studio",
  "model": "google/gemini-2.5-flash-image",
  "object": "chat.completion.chunk",
  "created": 1760008258,
  "choices": [
    {
      "index": 0,
      "delta": {
        "role": "assistant",
        "content": "",
        "images": [
          {
            "type": "image_url",
            "image_url": {
              "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA..."
            },
            "index": 0
          }
        ]
      },
      "finish_reason": "stop"
    }
  ]
}
```

---

## üé® –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ UI

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ñ Assistant                        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ –í–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ç–∞:              ‚îÇ ‚Üê content
‚îÇ                                     ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ ‚îÇ
‚îÇ ‚îÇ      [Generated Image]          ‚îÇ ‚îÇ ‚Üê generatedImages
‚îÇ ‚îÇ                                 ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ üí∞ Cost: 0.05 RUB                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### CSS —Å—Ç–∏–ª–∏:

```css
.generated-images {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 14px;
}

.generated-image {
  width: 100%;
  max-width: 512px;
  height: auto;
  border-radius: 8px;
}
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
1. –ú–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   ‚Üì
2. Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SSE —Å delta.images
   ‚Üì
3. ChatViewModel –ø–∞—Ä—Å–∏—Ç images –∏–∑ delta
   ‚Üì
4. message.addGeneratedImages(images)
   ‚Üì
5. MessageModel —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ generatedImages[]
   ‚Üì
6. MessageItem –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   ‚Üì
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

---

## üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### Base64:
```typescript
{
  "type": "image_url",
  "image_url": {
    "url": "data:image/png;base64,iVBORw0KGgo..."
  }
}
```

### URL:
```typescript
{
  "type": "image_url",
  "image_url": {
    "url": "https://example.com/image.png"
  }
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
> –ù–∞—Ä–∏—Å—É–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º

**–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:**
> –í–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∑–∞–∫–∞—Ç–∞ –Ω–∞–¥ –º–æ—Ä–µ–º:
> 
> [–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è]

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ:

```typescript
delta.images = [
  { type: "image_url", image_url: { url: "data:image/png..." } },
  { type: "image_url", image_url: { url: "data:image/png..." } },
  { type: "image_url", image_url: { url: "data:image/png..." } }
]
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```javascript
// –í ChatViewModel –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
console.log("Parsed images:", images);
// [{ type: "image_url", image_url: { url: "data:..." } }]

console.log("Adding generated images:", images.length, "images");
// Adding generated images: 1 images

// –í MessageModel:
message.generatedImages
// [{ type: "image_url", ... }]
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ DevTools:

```javascript
// –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
chatViewModel.messages.forEach(msg => {
  if (msg.generatedImages.length > 0) {
    console.log('Message with images:', msg.id, msg.generatedImages);
  }
});
```

---

## üì± Responsive –¥–∏–∑–∞–π–Ω

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞:

- **Desktop:** max-width: 512px
- **Mobile:** width: 100% (—Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É)
- **Aspect ratio:** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (height: auto)

---

## üöÄ –ú–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

- `google/gemini-2.5-flash-image` ‚úÖ
- `google/gemini-pro-vision-image` (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –î—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏ —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-image`

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ SSE
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ UI
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Base64
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ URL
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ Lazy loading
- ‚úÖ Responsive –¥–∏–∑–∞–π–Ω

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
- [ ] –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
- [ ] –ì–∞–ª–µ—Ä–µ—è –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
- [ ] –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `MessageModel.ts` - –º–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- `ChatViewModel.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ SSE –∏ –ø–∞—Ä—Å–∏–Ω–≥ images
- `MessageItem.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ UI

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏ –æ–Ω–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —á–∞—Ç–µ! üé®

